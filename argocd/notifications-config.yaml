# =============================================================================
# ArgoCD Notification Config
# =============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-notifications-cm
  namespace: argocd
data:
  # Slack integration
  service.slack: |
    token: $slack-token

  # Notification templates
  template.app-sync-succeeded: |
    message: |
      ✅ {{.app.metadata.name}} sync succeeded
      Version: {{.app.status.sync.revision}}
      Environment: {{.app.spec.destination.namespace}}

  template.app-sync-failed: |
    message: |
      ❌ {{.app.metadata.name}} sync FAILED
      Error: {{.app.status.conditions}}
      Environment: {{.app.spec.destination.namespace}}

  template.app-health-degraded: |
    message: |
      ⚠️ {{.app.metadata.name}} health degraded
      Status: {{.app.status.health.status}}
      Environment: {{.app.spec.destination.namespace}}

  # Triggers
  trigger.on-sync-succeeded: |
    - when: app.status.operationState.phase in ['Succeeded']
      send: [app-sync-succeeded]

  trigger.on-sync-failed: |
    - when: app.status.operationState.phase in ['Error', 'Failed']
      send: [app-sync-failed]

  trigger.on-health-degraded: |
    - when: app.status.health.status == 'Degraded'
      send: [app-health-degraded]
